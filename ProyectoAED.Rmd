---
title: "ProyectoAED"
# author: "Javier Herrero Pérez"
date: "2025-10-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
rm(list=ls())
```

# Carga de Librerías

```{r}
# Aquí habría que hacer algún scrip para descargar las librerías si no las tienen
library(readr)
library(dplyr)
library(tidyr)
library(janitor)
```



# Significado de los datos del Mercado Laboral

Este conjunto de datos ha sido transformado al formato tidy para que las filas correspondan a una única observación junto a las medidas de la Encuesta de Población Activa se encuentren en columnas separadas.

Los datos activos se relacionan de la siguiente manera:

$$\text{Activos}=\text{Ocupados}+\text{Parados}$$
Y el valor Total de la siguiente forma:


$$\text{Total}=\text{Activos}+\text{Inactivos}$$


# Limpieza de los datos

**Pasos para la limpieza de datos:**

1. Ver la codificación del archivo para compilarlo con la codificación correcta.

2. Importar los datos teniendo en cuenta que los valores NA son ".." y poner el signo decimal como ",".

3. Ver qué formato tienen las variables.

4. Limpiar el dataframe usando tidyverse:
- Redefinir "Relación con la actividad económica" por una más corta ("Situacion_Laboral")
- Cambiar el formato de las variables

4. Ver en qué columna y la cantidad de valores NA con `sapply(df, function(x) sum(is.na(x)))`

5. Se guarda en un dataframe `df_na` las instancias con na 

6. Transformar el dataframe a un dataframe tidy utilizando los valores de "Situacion_Laboral"

7. Poner a 0 los valores NA
Los valores faltantes son aquellos valores correspondientes al grupo de edades altos de paro o en busca de trabajo. Estos valores rondan el valor 0 (los que están en el dataframe) entonces se opta poner a 0 todos esos valores para no perder las instancias.

8. Añadir columnas de Tasa de Paro, Tasa de Actividad y Tasa de Ocupación


```{r}
# Ver el tipo de codificación del archivo
archivo<-"data/65948.csv"
guess_encoding(archivo)
```
# Limpieza basica
```{r}
#Limpieza de nombres de columnas
library(readr)
datos <- read_delim("data/65948.csv", delim = "\t")
library(janitor)
datos <- datos %>% clean_names()
datos
```




# Limpieza avanzada y transformación de los datos

```{r}
df <-  read_delim(archivo, delim = "\t", escape_double = FALSE, na = "..", trim_ws = TRUE,locale = locale(decimal_mark = ","))
```


```{r}
str(df)
```

```{r}
# Limpiar el dataframe usando tidyverse
df_limpio<-df %>% rename(Situacion_Laboral = `Relación con la actividad económica`) %>% mutate(Sexo=as.factor(Sexo), Edad=as.factor(Edad), Situacion_Laboral=as.factor(Situacion_Laboral))
```

```{r}
# Guardar los valores NA por si los necesitamos
df_na<-df[which(is.na(df$Total)),]
```

```{r}
df_tidy <- df_limpio %>%
  # Creamos nuevas columnas a partir de los valores de 'Situacion_Laboral'
  pivot_wider(
    names_from = Situacion_Laboral, # Los nombres de las nuevas columnas vienen de aquí
    values_from = Total            # Los valores de las nuevas columnas vienen de aquí
  ) %>% mutate(across(.cols=all_of(c("Parados","Parados que buscan primer empleo")),.fns=~replace_na(.,0))) %>% rename(Parados_sin_exp = `Parados que buscan primer empleo`)
```


```{r}
levels_sexo<-levels(df_limpio$Sexo)
levels_edad<-levels(df_limpio$Edad)
```


```{r}
sapply(df_tidy,function(x) sum(is.na(x)))
```
```{r}
# Hay algun NA?
datos %>% filter(if_any(everything(), is.na))
```


```{r}
summary(datos)
```


```{r}
df_tidy$Tasa_paro<-df_tidy$Parados/df_tidy$Activos*100
df_tidy$Tasa_actividad<-df_tidy$Activos/df_tidy$Total*100
df_tidy$Tasa_ocupacion<-df_tidy$Ocupados/df_tidy$Total*100
```

