---
title: "ProyectoAED"
# author: "Javier Herrero Pérez"
date: "2025-10-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
rm(list=ls())
```

# Carga de Librerías

```{r}
# Aquí habría que hacer algún scrip para descargar las librerías si no las tienen
library(readr)
library(dplyr)
library(tidyr)
```



# Significado de los datos

$$\text{Activos}=\text{Ocupados}+\text{Parados}$$

$$\text{Total}=\text{Activos}+\text{Inactivos}$$


# Limpieza de los datos

**Pasos para la limpieza de datos:**

1. Ver la codificación del archivo para compilarlo con la codificación correcta.

2. Importar los datos teniendo en cuenta que los valores NA son ".." y poner el signo decimal como ","

3. Redefinir "Relación con la actividad económica" por una más corta

4. Ver en qué columna y la cantidad de valores NA con `sapply(df, function(x) sum(is.na(x)))`

5. Se guarda en un dataframe `df_na` las instancias con na 

6. Se eliminan del dataframe original los datos faltantes

7. Se transforman los datos al tipo idóneo para trabajar con ellos

8. Pasar el dataset como tidy:
  En el dataframe descargado se tiene una columna total que contiene multiples variables a la vez. Se puede convertir a tidy usando `tidyr::pivot_wider()` 

9. Añadir columnas de Tasa de Paro, Tasa de Actividad y Tasa de Ocupación


```{r}
# Ver el tipo de codificación del archivo
archivo<-"data/65948.csv"
guess_encoding(archivo)
```



```{r}
df <-  read_delim(archivo, delim = "\t", escape_double = FALSE, na = "..", trim_ws = TRUE,locale = locale(decimal_mark = ","))
```


```{r}
str(df)
```


```{r}
# Comprobar los valores NA
sapply(df, function(x) sum(is.na(x)))
```

```{r}
# Limpiar el dataframe usando tidyverse
df_limpio<-df %>% rename(Situacion_Laboral = `Relación con la actividad económica`) %>% na.omit() %>% mutate(Sexo=as.factor(Sexo), Edad=as.factor(Edad), Situacion_Laboral=as.factor(Situacion_Laboral))
```

```{r}
# Guardar los valores NA por si los necesitamos
df_na<-df[which(is.na(df$Total)),]
```

```{r}
levels_sexo<-levels(df_limpio$Sexo)
levels_edad<-levels(df_limpio$Edad) # habría que ordenarlo
```

```{r}
df_tidy <- df_limpio %>%
  # Creamos nuevas columnas a partir de los valores de 'Situacion_Laboral'
  pivot_wider(
    names_from = Situacion_Laboral, # Los nombres de las nuevas columnas vienen de aquí
    values_from = Total            # Los valores de las nuevas columnas vienen de aquí
  )
```



```{r}
sapply(df_tidy,function(x) sum(is.na(x)))
```


