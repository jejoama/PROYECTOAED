---
title: "definitivo"
output: html_document
date: "2025-10-28"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list=ls())
```




## GRAFICAS JOE


IMPORTAMOS EL ARCHIVO CSV

```{r}
library(readr)
df_clean <- read_csv("data/df_clean.csv")

```

Aggrupación de datos por periodo y por sexo
```{r}
# Calculamos la media de la tasa de actividad para cada grupo
# Usamos na.rm = TRUE para ignorar valores faltantes
# .groups = "drop" elimina la agrupación después del resumen
df_p_sexo <- df_clean %>% group_by(Periodo, Sexo) %>% summarise(tasa_actividad = mean(Tasa_actividad, na.rm = TRUE) #Hay que ignorar los valores NA
                                                                , .groups = "drop") #hay que eliminar esas agrupaciones 

#Que pretendemos? Calcular la media de la tasa de actividad de todos los grupos del df



```

```{r}
# Gráfica 
library(ggplot2)
ggplot(df_p_sexo, aes(x = Periodo, y = tasa_actividad, color = Sexo)) + geom_line(linewidth = 2) +  labs(title = "Tasa de actividad según sexo (2006–2024)", x = "Año", y = "% Tasa de actividad",color = "Sexo") + theme_minimal()  

# Eje X:Periodo -  Eje Y: tasa de actividad promedio


```
```{r}
cat("La gráfica enseña la evolución de la tasa de actividad en España entre los años 2006 y 2024, diferenciada por sexo. Por un lado, la proporción de hombres es mucho mayor a la de mujeres, cosa que va ligada a que los hombres siempre han tenido mayor participicaion en muchos mas sectores, como lo puede ser la construcción, y a que las mujeres se ligan mas al cuidado familiar.
    Pese a esto, la actividad masculina en 2008 se desacelera economicamnete, esto provocado por la crisis financiera que se vivió en la epoca. Es en 2017/18 que comienza su recuperación, pero nunca a los niveles previos a la crisis. En 2020, debido al Covid-19, se observa otra caida en la tendencía (porque el Covid-19 afectó a muchos sectores, como la industría por ejemplo). Aunque se observa también su recuperació, tampoco volvió a los nieveles previos de la crisis de 2008
    por el otro lado, la tasa de actividad femenina se muestra, en el periodo, ascendente ya que han ido incorporandose cada vez mas en el mercado laboral español.\n")
```




Tasa de actividad por edad y sexo

```{r}
# Agrupamos por Periodo, sexo y Edad

##Que pretendemos? Calcular la media de la tasa de actividad para cada combinación
df_sexo_edad <- df_clean %>% group_by(Periodo, Sexo, Edad) %>% summarise(tasa_actividad = mean(Tasa_actividad, na.rm = TRUE),.groups = "drop")

```

```{r}

ggplot(df_sexo_edad, aes(x = Periodo, y = tasa_actividad, color = Edad)) + geom_line(linewidth = 1) +  facet_wrap(~Sexo) + scale_x_continuous(breaks = seq(2006, 2024, by = 2)) + scale_y_continuous(labels = scales::comma) +  labs(title = "Tasa de actividad por edad y sexo (2006–2024)", x = "Año", y = "Tasa de actividad (%)", color = "Edad") + theme_minimal()  + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10))

```


TASA DE PARO POR SEXO
```{r}
df_paro_sexo <- df_clean %>% group_by(Periodo, Sexo) %>% summarise(tasa_paro = mean(Tasa_paro, na.rm = TRUE), .groups = "drop")

ggplot(df_paro_sexo, aes(x = Periodo, y = tasa_paro, color = Sexo)) + geom_line() + scale_x_continuous(breaks = seq(2006, 2024, by = 2))+ labs(title = "Tasa de paro por sexo (2006–2024)", x = "Año", y = "Tasa de paro (%)") + theme_minimal()

```


Distribución de ocupados e inactivos por sexo

```{r}
df_ocup_inact <- df_clean %>%
  group_by(Sexo) %>%
  summarise(
    Ocupados = sum(Ocupados, na.rm = TRUE),
    Inactivos = sum(Inactivos, na.rm = TRUE)
  ) %>%
  pivot_longer(cols = c(Ocupados, Inactivos), names_to = "Situacion", values_to = "Personas")


```

```{r}
ggplot(df_ocup_inact, aes(x = Sexo, y = Personas, fill = Situacion)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Distribución de ocupados e inactivos por sexo", x = "Sexo", y = "Personas")
```




Estadisiticas
```{r}
df_brecha_genero <- df_clean %>% group_by(Periodo, Sexo) %>% summarise(tasa = mean(Tasa_actividad, na.rm = TRUE), .groups = "drop") %>% pivot_wider(names_from = Sexo, values_from = tasa) %>% mutate(Brecha = Hombres - Mujeres)

df_brecha_genero

```

```{r}
ggplot(df_brecha_genero, aes(x = Periodo, y = Brecha)) +
  geom_line(color = "red", linewidth = 2) +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed") + scale_y_continuous(breaks = seq(0, 20, by = 2))+
  labs(title = "Evolución de la brecha de género en la tasa de actividad",
       x = "Año", y = "Diferencia (Hombres - Mujeres)")

```



```{r}
ggplot(df_brecha_genero, aes(x = Periodo, y = Brecha)) +
  geom_point(color = "red") +
  geom_smooth(method = "loess", se = FALSE, color = "blue", linewidth = 1.2) + scale_y_continuous(breaks = seq(0, 20, by = 2))+ scale_x_continuous(breaks = seq(2006, 2024, by = 2)) +
  labs(
    title = "Interpolación de la brecha de género NO LINEAL",
    x = "Año",
    y = "Brecha (Hombres - Mujeres)"
  ) +
  theme_minimal()

```



hombres/mujeres
```{r}
brecha_relativa <- df_clean %>%
  group_by(Periodo, Sexo) %>%
  summarise(Tasa = mean(Tasa_actividad, na.rm = TRUE), .groups = "drop") %>%
  pivot_wider(names_from = Sexo, values_from = Tasa) %>%
  mutate(Razon = Hombres / Mujeres)

brecha_relativa

```

```{r}
ggplot(brecha_relativa, aes(x = Periodo, y = Razon)) +
  geom_line(color = "blue", linewidth = 1.2) +
  geom_point(color = "red", size = 2) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "gray") +  # línea de igualdad
  scale_y_continuous(breaks = seq(1, 1.5, by = 0.05)) +  # marcas cada 0.05
  scale_x_continuous(breaks = seq(2006, 2024, by = 2)) +  # años cada 2
  labs(
    title = "Evolución de la razón Hombres/Mujeres",
    x = "Año",
    y = "Razón (Hombres / Mujeres)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )
```



por edad
```{r}
# Filtrar para excluir el grupo de edad "70 y más años"
brecha_edad_filtrada <- brecha_edad %>%
  filter(Edad != "70 y más años")

# Graficar la razón Hombres/Mujeres por edad (sin el grupo de 70+)
ggplot(brecha_edad_filtrada, aes(x = Periodo, y = Razon, color = Edad)) +
  geom_line(linewidth = 1) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "gray") +
  scale_y_continuous(breaks = seq(0.5, 2, by = 0.1)) +
  scale_x_continuous(breaks = seq(2006, 2024, by = 2)) +
  labs(
    title = "Razón Hombres/Mujeres en la tasa de actividad por edad (sin 70+)",
    x = "Año",
    y = "Razón (Hombres / Mujeres)",
    color = "Edad"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

